# Дисциплина очередности

## qdisc

qdisc - сокращение от 'queueing discipline' (дисциплина очередности) и является базовым для понимания контроля трафика. Всякий раз, когда ядру требуется отправить пакет на интерфейс, этот пакет ставится в очередь к qdisc, настроенный для этого интерфейса. Сразу же после этого ядро пытается получить сколько можно пакетов из qdisc для передачи их драйверу сетевого адаптера.

Простейший QDISC является очередью 'pfifo' без обработки, лишь реализующей принцип "первый вошел - первый вышел". Однако он сохраняет трафик в очереди, если сетевой интерфейс не может обработать данные сразу же.

Некоторые очереди могут содержать классы, содержащие дополнительные очереди: трафик может быть поставлен в очередь внутренних очередей в рамках классов. Когда ядро пытается взять пакет из такой очереди с классами, он может прийти из любого класса. Очередь, например, может установить приоритет трафика, считывая пакеты из одних очередей раньше, чем из других. Соответсвенно различают безклассовые очереди и очереди с классами.

### Безклассовые очереди

- pfifo/bfifo - простейшие очереди без обработки, лишь реализующие принцип 'First In, First Out' (первый вошел - первый вышел). Ограничены в пакетах или байтах.
- pfifo_fast - стандартная очередь ядра с 'расширенным роутером'. Состоит из очереди с тремя потоками, учитывающей флаги типа услуги (Type of Service) и приоритет пакета.
- red - Random Early Detection (случайное раннее обнаружение) симулирует физический затор, отбрасывая пакеты случайным образом при близком достижении заданной полосы пропускания. Хорошо подходит для приложений, требующих очень широкую полосу пропускания.
- sfq - Stochastic Fairness Queueing (очередь равномерного случайного распределения пакетов) реорганизует трафик в очереди таким образом, что каждый 'сеанс' ('session', виртуальная подочередь) получает право отправить пакет, а маркер переходит на следующий сеанс.
- tbf - Token Bucket Filter (фильтр буфера токенов) удерживает скорость передачи пакетов на примерно постоянном уровне (меньшем, чем реальная скорость интерфейса). Хорошо масштабируется для широких каналов.

### Очереди с классами

- CBQ. 

Очередь, базирующая на классах (Class Based Queueing) реализует мощную иерархию классов. Поддерживает ограничения и приоритеты. Разделение осуществляется по времени простоя канала, вычисляемого на основании среднего размера пакета и полосы пропускания.

- HTB. 

Очередь HTB (Hierarchy Token Bucket - иерархический буфер токенов) реализует мощную иерархию классов с упором на согласование с существующей практикой. HTB обеспечивает гарантированную полосу пропускания для классов, также позволяет устанавливать верхние пределы межклассового разделения очереди. Содержит объекты ограничения, базирующиеся на TBF, и может устанавливать приоритеты для классов.

- PRIO. 

Очередь PRIO может разделять трафик между тремя полосами, которые являются очередями любого типа. При извлечении пакета из очереди вначале исследуется подочередь с большим приоритетом, если в последней нет пакетов для обработки, то выбирается очередь с более низким приоритетом и.т.д.. Для установки приоритета используются биты типа услуги (Type Of Service).

## Источник

https://www.opennet.ru/man.shtml?topic=tc&category=8&russian=0